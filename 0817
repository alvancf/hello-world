'use strict';
import React, {
    Component
} from 'react';
import {
    Dimensions,
    StyleSheet,
    Platform,
    ScrollView,
    Image,
    Text,
    View,
    Animated, Easing
} from "react-native";

const max0pacity = 1,//最大的透明度
    minOpacity = 0.0,//最小的透明度
    changeDuration = 400,//切换动画的时间
    change0pacity = 200,//透明动画的时间
    delayTime = 2000,//停留的时间
    textHeight = 14,//文本的高度
    textMarginBottom = 0;//两个文本之间的上下间距


class ScrollItem extends Component {
    constructor(props) {
        super(props);
        this.state = {
            textCount: this.props.textArray.length,
            translateY: new Animated.Value(0),
            oneFadeInOpacity: new Animated.Value(0), // 奇数行的透明度
            twoFadeInOpacity: new Animated.Value(0), // 偶数行的透明度
            threeFadeInOpacity: new Animated.Value(0), // 偶数行的透明度
        };
        this.isAnimate = true;
    }

    UNSAFE_componentWillReceiveProps(nextProps) {
        this.stopAnimate();
        this.parallelAnimate && this.parallelAnimate.stop();
        this.state.oneFadeInOpacity.setValue(0);
        this.state.twoFadeInOpacity.setValue(0);
        this.state.threeFadeInOpacity.setValue(0);
        this.state.translateY.setValue(0);
        this.setState({
            textCount: nextProps.textArray.length,
        }, () => {
            this.isAnimate = true;
            this.startAnimate()
        })
    }

    componentWillUnmount() {
        this.stopAnimate();
        this.parallelAnimate && this.parallelAnimate.stop();
    }

    componentDidMount() {
        this.startAnimate()
    }

    startAnimate() {
        if (this.state.textCount > 1) {
            this.showHeadBar(0, this.state.textCount);
        } else {
            if (this.state.textCount == 1) {
                this.state.oneFadeInOpacity.setValue(max0pacity);
            }
        }
    }

    showHeadBar(index, count) {
        index++;

        let indexValue = index - 1

        let startOneValue = minOpacity;
        let endOneValue = minOpacity;

        let startTwoValue = minOpacity;
        let endTwoValue = minOpacity;

        let startThreeValue = minOpacity;
        let endThreeValue = minOpacity;

        // console.log("---" + (index).toString())

        if ((index) % 3 == 1)//如有要平移第一行
        {
            startOneValue = max0pacity;
            endOneValue = minOpacity;
            startTwoValue = minOpacity;
            endTwoValue = max0pacity;
        } else if ((index) % 3 == 2)//如有要平移第二行
        {
            startTwoValue = max0pacity;
            endTwoValue = minOpacity;
            startThreeValue = minOpacity;
            endThreeValue = max0pacity;
        } else {//如有要平移第三行
            startThreeValue = max0pacity;
            endThreeValue = minOpacity;
            startOneValue = minOpacity;
            endOneValue = max0pacity;
        }

        this.state.oneFadeInOpacity.setValue(startOneValue);
        this.state.twoFadeInOpacity.setValue(startTwoValue);
        this.state.threeFadeInOpacity.setValue(startThreeValue);
        this.parallelAnimate = Animated.parallel([
            Animated.timing(this.state.translateY, {
                toValue: -textHeight * index - textMarginBottom * index, //40为文本View的高度
                duration: changeDuration, //动画时间
                Easing: Easing.linear,
                delay: delayTime, //文字停留时间
                useNativeDriver: false,
            }),
            Animated.timing(this.state.oneFadeInOpacity, {
                toValue: endOneValue, // 目标值
                duration: change0pacity, // 动画时间
                easing: Easing.linear, // 缓动函数
                delay: delayTime, //文字停留时间
                useNativeDriver: false,
            }),
            Animated.timing(this.state.twoFadeInOpacity, {
                toValue: endTwoValue, // 目标值
                duration: change0pacity, // 动画时间
                easing: Easing.linear, // 缓动函数
                delay: delayTime, //文字停留时间
                useNativeDriver: false,
            }),
            Animated.timing(this.state.threeFadeInOpacity, {
                toValue: endThreeValue, // 目标值
                duration: change0pacity, // 动画时间
                easing: Easing.linear, // 缓动函数
                delay: delayTime, //文字停留时间
                useNativeDriver: false,
            })
        ]);
        this.parallelAnimate && this.parallelAnimate.start(() => {
            if (!this.isAnimate) return;
            //每一个动画结束后的回调
            if (index >= count) {
                index = 0;
                this.state.translateY.setValue(0);
            }
            this.showHeadBar(index, count); //循环动画
        });
    }

    stopAnimate() {
        this.isAnimate = false;
    }

    renderItem = (element, index) => {
        return (
            <View
                style={{
                    height: 14,
                    overflow: 'hidden',
                }}
                key={index}
            >
                <Text
                    numberOfLines={1}
                    textStyle={this.props.textStyle}
                >{element}</Text>
            </View>
        );
    }

    render() {
        let myArray = this.props.textArray;
        let pages = [];
        if (myArray != null && this.state.textCount > 0) {
            // console.log(this.props.textArray);
            myArray.map((todo, index) => {
                let element = this.props.textArray[index];
                pages.push(
                    <Animated.View
                        style={[
                            styles.demo, {
                                opacity: (index + 1) % 3 == 1 ? this.state.oneFadeInOpacity : ((index + 1) % 3 == 2) ? this.state.twoFadeInOpacity : this.state.threeFadeInOpacity
                            }]}
                        key={index}
                    >
                        {this.renderItem(element, index)}
                    </Animated.View>
                );
            })

            //默认最后一个就是第一个
            let element = this.props.textArray[0];
            let index = this.state.textCount + 1;
            pages.push(
                <Animated.View
                    style={[styles.demo, {
                        opacity: index % 3 == 1 ? this.state.oneFadeInOpacity : ((index) % 3 == 2) ? this.state.twoFadeInOpacity : this.state.threeFadeInOpacity
                    }]}
                    key={index}
                >
                    {this.renderItem(element, index)}
                </Animated.View>
            );
        }
        return (
            <View style={{
                display: 'flex',
                overflow: 'hidden',
                height: 15,
                // justifyContent:'center'
            }}>
                <Animated.View
                    style={[
                        styles.wrapper,
                        {
                            transform: [{
                                translateY: this.state.translateY
                            }]
                        }
                    ]}
                >
                    {pages}
                </Animated.View>
            </View>
        )
    }
}


/**
 * gen_by WX Platform
 * gen_date: 2024-08-23 10:39:34
 * @author:shiguangjie
 * wx_5cf4e4d1ac2ca18782fae507e7c09ea1_nd0s
 */
export default class MainComponent extends Component {

    constructor(props) {
        super(props);
        this.spinValue = new Animated.Value(0)
        this.state = {
            isShowing: true,
            msg: '加载中...'
        }
    }

    componentDidMount() {
        this.spin();
    }
    spin = () => {
        if (!this.state.isShowing) {
            return;
        }
        this.spinValue.setValue(0)
        this.animation = Animated.timing(this.spinValue, {
            toValue: 1, // 最终值 为1，这里表示最大旋转 360度
            duration: 800,
            easing: Easing.linear,
            useNativeDriver: false,
        }).start(() => {
            this.spin();
        })
    }
    /**
     * 适配小米&1加手机的text展示不全问题
     * @returns {*}
     */
    getTextAdapterStyle() {
        if (Platform.OS == 'android') {
            return {
                fontFamily: 'normal',
            }
        }
        return {};
    }
    getWindowWidth() {
        let width = Dimensions.get("screen")
            .width;
        return width;
    }
    /**
     * ImageView组件默认图
     * @returns {string}
     */
    getImageDefaultUri() {
        return '';
    }

    onResume = () => {

    }
    onPause = () => {

    }
    render() {
        let list=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]
        return(
            <View style={{display:'flex'}}>
                <ScrollView showsVerticalScrollIndicator={false} style={{margin:20}}>
                    {
                        list.map(item=>{
                            return this.renderItem(item)
                        })
                    }
                </ScrollView>
                {this.renderLoading()}
                {/*<AHRNSurfaceStatusView*/}
                {/*    // 懒加载影响方法不执行，不建议使用*/}
                {/*    // onBootResume={this.onBootResume}*/}
                {/*    onResume={this.onResume}*/}
                {/*    onPause={this.onPause}/>*/}
            </View>

        )
    }

    renderLoading(){
        const spin = this.spinValue.interpolate({
            inputRange: [0, 1],//输入值
            outputRange: ['0deg', '360deg'] //输出值
        })

        return(
            <View style={{
                flex: 1,
                width: '100%',
                height: '100%',
                position: 'absolute',
                justifyContent: 'center',
                alignItems: 'center',
                backgroundColor: 'rgba(0, 0, 0, 0.0)',
            }}>
                <View style={{
                    display:'flex',
                    height: 100,
                    width: 100,
                    backgroundColor: 'rgba(0, 0, 0, 0.9)',
                    borderRadius: 8,
                    justifyContent: 'center',
                    alignItems: 'center',
                    position:'absolute',
                    top:50,
                    zIndex:100
                }}>
                    <Animated.View
                        style={{transform: [{rotate: spin}]}}>
                        {/*<DpImage*/}
                        {/*    defaultUri={''}*/}
                        {/*    style={{height: 20, width: 20}}*/}
                        {/*    uri={'gif_loading.gif'}*/}
                        {/*/>*/}
                        <Image
                            resizeMode={"contain"}
                            style={{
                                width: 52,
                                height: 52,
                                borderRadius: 2
                            }}
                            source={{
                                uri: 'https://img2.autoimg.cn/g32/M07/2F/E7/ChxkPmbH9mWAFSvXAAA5BLWQ8vw206.png'
                            }}/>
                    </Animated.View>
                    <Text
                        numberOfLines={1}
                        textStyle={{
                            fontSize: 14, fontWeight: '400', color: 'white', width: 90, textAlign: 'center',
                            alignItems: 'center', justifyContent: 'center', textAlignVertical: 'center',
                        }}
                    >加载中...</Text>


                </View>

            </View>
        )
    }
    renderItem(item) {
        let price=["92# 7.74元", "95# 8.24元"]

        let colors = ['#FFE1D1', '#FFF3E9'];
        let left = 12;
        return (<View
            style={{
                display: 'flex',
                width: this.getWindowWidth() - 32,
                height: 141,
                borderRadius: 2,
                flexDirection: 'column',
                // backgroundImage: ' linear-gradient(90deg, rgba(255,225,209,1) 0%,rgba(255,243,233,1) 100%)'
            }}>
            {/*<AHLinearGradientView*/}
            {/*    pointerEvents={'none'}*/}
            {/*    start={{x: 0.5, y: 0}}*/}
            {/*    end={{x: 0.5, y: 1}}*/}
            {/*    colors={colors}*/}
            {/*    style={{*/}
            {/*        width: getWindowWidth() - left*2, // height: 400,*/}
            {/*        borderRadius: 2,*/}
            {/*        top: 4,*/}
            {/*        left: left,*/}
            {/*        bottom: 0,*/}
            {/*        position:'absolute'*/}
            {/*    }}*/}
            {/*/>*/}
            <View
                style={{
                    display: 'flex',
                    width: this.getWindowWidth() - 32,
                    height: 141,
                    borderRadius: 2,
                    flexDirection: 'column'
                }}>
                <View
                    style={{
                        display: 'flex',
                        width: this.getWindowWidth() - 32,
                        height: 141,
                        borderRadius: 2,
                        flexDirection: 'column'
                    }}>
                    <View
                        style={{
                            display: 'flex',
                            width: this.getWindowWidth() - 32,
                            height: 141,
                            borderRadius: 2,
                            flexDirection: 'column'
                        }}>
                        <View
                            style={{
                                display: 'flex',
                                width: this.getWindowWidth() - 56,
                                height: 22,
                                marginTop: 4,
                                marginLeft: 12,
                                flexDirection: 'row',
                                alignItems: 'center',
                                justifyContent: 'space-between'
                            }}>
                            <Text
                                numberOfLines={1}
                                style={{
                                    color: '#862800',
                                    fontSize: 16,
                                    fontWeight: '500',
                                    textAlign: 'left'
                                }}>优选油站</Text>
                            {/*<Text*/}
                            {/*    numberOfLines={1}*/}
                            {/*    style={{*/}
                            {/*        color: '#862800',*/}
                            {/*        fontSize: 12,*/}
                            {/*        fontWeight: '400',*/}
                            {/*        textAlign: 'right'*/}
                            {/*    }}>#今日油价：92# 8.67元</Text>*/}
                            {/*{*/}
                            {/*    item==1&&*/}
                            {/*    <ScrollItem*/}
                            {/*        textArray={price}*/}
                            {/*        textStyle={{*/}
                            {/*            color: 'black', fontSize: 12, fontWeight: '400', lineHeight: 15.5*/}
                            {/*        }}*/}
                            {/*    />*/}
                            {/*}*/}
                            <ScrollItem
                                textArray={price}
                                textStyle={{
                                    color: 'black', fontSize: 12, fontWeight: '400', lineHeight: 15.5
                                }}
                            />

                        </View>
                        <View
                            style={{
                                display: 'flex',
                                width: this.getWindowWidth() - 40,
                                height: 107,
                                backgroundColor: '#ffffff',
                                borderRadius: 2,
                                marginTop: 4,
                                marginLeft: 4,
                                flexDirection: 'column'
                            }}>
                            <View
                                style={{
                                    display: 'flex',
                                    width: this.getWindowWidth() - 54,
                                    height: 98,
                                    marginTop: 8,
                                    marginLeft: 8,
                                    flexDirection: 'row'
                                }}>
                                <Image
                                    resizeMode={"contain"}
                                    style={{
                                        width: 52,
                                        height: 52,
                                        borderRadius: 2
                                    }}
                                    source={{
                                        uri: 'https://img2.autoimg.cn/g32/M07/2F/E7/ChxkPmbH9mWAFSvXAAA5BLWQ8vw206.png'
                                    }}/>
                                <View
                                    style={{
                                        display: 'flex',
                                        width: 262,
                                        height: 98,
                                        marginLeft: 7,
                                        flexDirection: 'column'
                                    }}>
                                    <View
                                        style={{
                                            display: 'flex',
                                            width: 260,
                                            height: 22,
                                            marginLeft: 1,
                                            flexDirection: 'row',
                                            alignItems: 'center'
                                        }}>
                                        <Image
                                            resizeMode={"contain"}
                                            style={{
                                                width: 30,
                                                height: 16
                                            }}
                                            source={{
                                                uri: 'https://img2.autoimg.cn/g32/M03/2F/F1/Chtk2WbH9mWAZjpIAAAIHRJJfe8992.png'
                                            }}/>
                                        <Text
                                            numberOfLines={1}
                                            style={{
                                                color: '#111e36',
                                                fontSize: 16,
                                                fontWeight: '500',
                                                textAlign: 'left',
                                                marginLeft: 3
                                            }}>壳牌加油站小营西路站</Text>
                                        <Image
                                            resizeMode={"contain"}
                                            style={{
                                                width: 10,
                                                height: 10,
                                                marginLeft: 7
                                            }}
                                            source={{
                                                uri: 'https://img2.autoimg.cn/g32/M03/2F/E6/ChxkPWbH9mWADKCAAAAB3-VmKpg733.png'
                                            }}/>
                                        <Text
                                            numberOfLines={1}
                                            style={{
                                                color: '#828ca0',
                                                fontSize: 12,
                                                fontWeight: '400',
                                                textAlign: 'left',
                                                marginLeft: 3
                                            }}>5.67km</Text>
                                    </View>
                                    <Text
                                        numberOfLines={1}
                                        style={{
                                            color: '#828ca0',
                                            fontSize: 12,
                                            fontWeight: '400',
                                            textAlign: 'left',
                                            marginTop: 2
                                        }}>北京市海淀区京昌高速辅路小桥</Text>
                                    <View
                                        style={{
                                            display: 'flex',
                                            width: 140,
                                            height: 16,
                                            marginTop: 4,
                                            marginLeft: 1,
                                            flexDirection: 'row'
                                        }}>
                                        <View
                                            style={{
                                                display: 'flex',
                                                width: 48,
                                                height: 16,
                                                border: '1 solid rgba(191,197,210,1)',
                                                flexDirection: 'column'
                                            }}>
                                            <View
                                                style={{
                                                    display: 'flex',
                                                    width: 48,
                                                    height: 16,
                                                    borderRadius: 2,
                                                    border: '1 solid rgba(191,197,210,1)',
                                                    marginTop: -2,
                                                    marginLeft: -1,
                                                    flexDirection: 'column',
                                                    alignItems: 'center',
                                                    justifyContent: 'center'
                                                }}>
                                                <Text
                                                    numberOfLines={1}
                                                    style={{
                                                        color: '#828ca0',
                                                        fontSize: 10,
                                                        fontWeight: '400',
                                                        textAlign: 'left'
                                                    }}>线上开票</Text>
                                            </View>
                                        </View>
                                        <View
                                            style={{
                                                display: 'flex',
                                                width: 46,
                                                height: 16,
                                                border: '1 solid rgba(191,197,210,1)',
                                                marginLeft: 4,
                                                flexDirection: 'column'
                                            }}>
                                            <View
                                                style={{
                                                    display: 'flex',
                                                    width: 46,
                                                    height: 16,
                                                    borderRadius: 2,
                                                    border: '1 solid rgba(191,197,210,1)',
                                                    marginTop: -2,
                                                    marginLeft: -1,
                                                    flexDirection: 'column',
                                                    alignItems: 'center',
                                                    justifyContent: 'center'
                                                }}>
                                                <Text
                                                    numberOfLines={1}
                                                    style={{
                                                        color: '#828ca0',
                                                        fontSize: 10,
                                                        fontWeight: '400',
                                                        textAlign: 'center'
                                                    }}>24h营业</Text>
                                            </View>
                                        </View>
                                        <View
                                            style={{
                                                display: 'flex',
                                                width: 38,
                                                height: 16,
                                                backgroundColor: '#ffffff',
                                                borderRadius: 2,
                                                border: '1 solid rgba(255,218,193,1)',
                                                marginLeft: 4,
                                                flexDirection: 'column',
                                                alignItems: 'center',
                                                justifyContent: 'center'
                                            }}>
                                            <Text
                                                numberOfLines={1}
                                                style={{
                                                    color: '#ff6600',
                                                    fontSize: 10,
                                                    fontWeight: '400',
                                                    textAlign: 'center'
                                                }}>可用券</Text>
                                        </View>
                                    </View>
                                    <View
                                        style={{
                                            display: 'flex',
                                            width: 261,
                                            height: 31,
                                            marginTop: 6,
                                            marginLeft: 1,
                                            flexDirection: 'row'
                                        }}>
                                        <Text
                                            numberOfLines={1}
                                            style={{
                                                color: '#ff6600',
                                                fontSize: 14,
                                                fontWeight: '500',
                                                textAlign: 'left',
                                                marginTop: 8
                                            }}>¥</Text>
                                        <Text
                                            numberOfLines={1}
                                            style={{
                                                color: '#ff6600',
                                                fontSize: 20,
                                                fontWeight: '900',
                                                textAlign: 'left',
                                                marginTop: 4,
                                                marginLeft: 2
                                            }}>8.46</Text>
                                        <Text
                                            numberOfLines={1}
                                            style={{
                                                color: '#ff6600',
                                                fontSize: 14,
                                                fontWeight: '500',
                                                textAlign: 'left',
                                                marginTop: 9,
                                                marginLeft: 1
                                            }}>/L</Text>
                                        <View
                                            style={{
                                                display: 'flex',
                                                width: 100,
                                                height: 16,
                                                marginTop: 8,
                                                marginLeft: 3,
                                                flexDirection: 'row'
                                            }}>
                                            <View
                                                style={{
                                                    display: 'flex',
                                                    width: 64,
                                                    height: 16,
                                                    backgroundColor: '#ffeee5',
                                                    borderRadius: 2,
                                                    zIndex: 11,
                                                    flexDirection: 'row',
                                                    alignItems: 'center'
                                                }}>
                                                <Text
                                                    numberOfLines={1}
                                                    style={{
                                                        color: '#8e3f08',
                                                        fontSize: 10,
                                                        fontWeight: '500',
                                                        textAlign: 'left',
                                                        marginLeft: 4
                                                    }}>加满200</Text>
                                                <Image
                                                    resizeMode={"contain"}
                                                    style={{
                                                        width: 13,
                                                        height: 16,
                                                        marginLeft: 1
                                                    }}
                                                    source={{
                                                        uri: 'https://img2.autoimg.cn/g32/M06/2F/E7/ChxkPmbH9mWAcvtKAAAE3g5COmM499.png'
                                                    }}/>
                                            </View>
                                            <View
                                                style={{
                                                    display: 'flex',
                                                    width: 46,
                                                    height: 16,
                                                    backgroundColor: '#ff7e40',
                                                    borderRadius: 2,
                                                    zIndex: 13,
                                                    marginLeft: -10,
                                                    flexDirection: 'column',
                                                    alignItems: 'center',
                                                    justifyContent: 'center'
                                                }}>
                                                <Text
                                                    numberOfLines={1}
                                                    style={{
                                                        color: '#ffffff',
                                                        fontSize: 10,
                                                        fontWeight: '500',
                                                        textAlign: 'left'
                                                    }}>减24.69</Text>
                                            </View>
                                        </View>
                                        <View
                                            style={{
                                                display: 'flex',
                                                width: 60,
                                                height: 24,
                                                backgroundColor: '#ffefe5',
                                                borderRadius: 2,
                                                marginLeft: 33,
                                                flexDirection: 'column',
                                                alignItems: 'center',
                                                justifyContent: 'center'
                                            }}>
                                            <Text
                                                numberOfLines={1}
                                                style={{
                                                    color: '#111e36',
                                                    fontSize: 12,
                                                    fontWeight: '500',
                                                    textAlign: 'center'
                                                }}>去加油</Text>
                                        </View>
                                    </View>
                                </View>
                            </View>
                        </View>
                    </View>
                </View>
            </View>
        </View>);
    }
}
let styles = StyleSheet.create({
    wrapper: {
        marginHorizontal: 0,
        paddingTop: 0,
        overflow: 'hidden'
    },
    demo: {
        overflow: 'hidden'
    }
})
